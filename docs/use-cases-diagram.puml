@startuml UseCases
title Diagrama de Casos de Uso - Sistema de Call Tracking

!define RECTANGLE class

actor "Sistema de Adquisición" as Acquisition
actor "Call Worker" as Worker
actor "Administrador del Sistema" as Admin
actor "Retell AI API" as Retell
actor "MongoDB" as DB

package "Sistema de Call Tracking" {
    
    usecase "Crear Jobs de Llamadas" as UC1
    usecase "Procesar Jobs Pendientes" as UC2
    usecase "Reservar Job" as UC3
    usecase "Iniciar Llamada" as UC4
    usecase "Hacer Seguimiento de Llamada" as UC5
    usecase "Guardar Resultados" as UC6
    usecase "Gestionar Reintentos" as UC7
    usecase "Manejar Múltiples Teléfonos" as UC8
    usecase "Calcular Costos" as UC9
    usecase "Generar Transcripciones" as UC10
    usecase "Monitorear Sistema" as UC11
    usecase "Reiniciar Jobs" as UC12
    usecase "Configurar Variables" as UC13
    usecase "Manejar Estados de Llamada" as UC14
    usecase "Actualizar Variables Dinámicas" as UC15
    
    ' Relaciones principales
    Acquisition --> UC1
    Worker --> UC2
    Worker --> UC3
    Worker --> UC4
    Worker --> UC5
    Worker --> UC6
    Worker --> UC7
    Worker --> UC8
    Admin --> UC11
    Admin --> UC12
    Admin --> UC13
    
    ' Relaciones con sistemas externos
    UC4 --> Retell
    UC5 --> Retell
    UC9 --> Retell
    UC10 --> Retell
    
    UC1 --> DB
    UC2 --> DB
    UC3 --> DB
    UC6 --> DB
    UC7 --> DB
    UC12 --> DB
    UC15 --> DB
    
    ' Extends y Includes
    UC2 ..> UC3 : include
    UC2 ..> UC4 : include
    UC2 ..> UC5 : include
    UC2 ..> UC6 : include
    
    UC4 ..> UC13 : include
    UC5 ..> UC14 : include
    UC6 ..> UC9 : include
    UC6 ..> UC10 : include
    UC6 ..> UC15 : include
    
    UC2 ..> UC7 : extend
    UC4 ..> UC8 : extend
    
    note right of UC1 : Jobs creados por workflow\nde adquisición (n8n)
    
    note right of UC2 : Proceso principal del worker\ncon concurrencia distribuida
    
    note right of UC5 : Polling cada 15 segundos\nhasta status final
    
    note right of UC7 : Delays inteligentes:\n30min normal, 60min no-answer
    
    note right of UC8 : to_number → try_phones[]\ncon tracking de progreso
}

@enduml